<div class="min-h-screen bg-gray-50">
  <!-- Header -->
  <header class="bg-white shadow-sm">
    <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
      <div class="flex items-center space-x-3">
        <button (click)="goBack()" class="text-gray-600 hover:text-gray-900">
          â† ZurÃ¼ck
        </button>
        <span class="text-3xl">ğŸ™Œ</span>
        <h1 class="text-2xl font-bold text-gray-900">High-Five geben</h1>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="card">
      <div *ngIf="success" class="mb-6 bg-success-50 border-l-4 border-success-500 p-4 rounded">
        <div class="flex items-center">
          <span class="text-2xl mr-3">âœ…</span>
          <div>
            <h3 class="text-sm font-medium text-success-800">
              High-Five erfolgreich gesendet!
            </h3>
            <p class="mt-1 text-sm text-success-700">
              Gesendet an {{ mentionedUsers.length }} Person(en). Weiterleitung zur Ãœbersicht...
            </p>
          </div>
        </div>
      </div>

      <form (ngSubmit)="onSubmit()" class="space-y-6">
        <!-- Nachricht mit @-ErwÃ¤hnung -->
        <div>
          <label for="message" class="label">Nachricht *</label>
          <div class="relative">
            <textarea
              #messageInput
              id="message"
              [(ngModel)]="message"
              name="message"
              (input)="handleInput($event)"
              (keydown)="handleKeydown($event)"
              rows="5"
              required
              class="input w-full min-h-[120px]"
              placeholder="Schreibe eine Nachricht und erwÃ¤hne Personen mit @Name..."
            ></textarea>

            <!-- Autocomplete Dropdown -->
            <div
              *ngIf="showSuggestions && filteredUsers.length > 0"
              class="absolute z-50 w-full max-h-60 overflow-auto bg-white rounded-lg shadow-lg border border-gray-200"
              [style.bottom.px]="100"
              [style.margin-bottom.rem]="0.5"
            >
              <div
                *ngFor="let user of filteredUsers; let i = index"
                (click)="selectUser(user)"
                [class.bg-gray-100]="i === selectedIndex"
                class="flex items-center space-x-3 p-3 cursor-pointer hover:bg-gray-50 transition"
              >
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-semibold">
                  {{ getUserInitials(user.name) }}
                </div>
                <div class="flex-1">
                  <div class="font-medium text-gray-900">{{ user.name }}</div>
                  <div class="text-sm text-gray-500">{{ user.email }}</div>
                </div>
              </div>
            </div>
          </div>
          <p class="mt-1 text-sm text-gray-500">
            Verwende @ um Teammitglieder zu erwÃ¤hnen. {{ message.length }}/500 Zeichen
          </p>
        </div>

        <!-- ErwÃ¤hnte Benutzer Vorschau -->
        <div *ngIf="mentionedUsers.length > 0" class="mb-4">
          <p class="text-sm text-gray-600 mb-2">High-Five geht an:</p>
          <div class="flex flex-wrap gap-2">
            <span
              *ngFor="let user of mentionedUsers"
              class="inline-flex items-center space-x-1 px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm"
            >
              <span>{{ user.name }}</span>
              <button
                type="button"
                (click)="removeMention(user.id)"
                class="ml-1 hover:text-blue-900 font-bold"
              >
                Ã—
              </button>
            </span>
          </div>
        </div>

        <!-- Vordefinierte Nachrichten -->
        <div>
          <label class="label">Schnellnachrichten</label>
          <div class="flex flex-wrap gap-2">
            <button
              *ngFor="let msg of predefinedMessages"
              type="button"
              (click)="usePredefinedMessage(msg)"
              class="px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition"
            >
              {{ msg }}
            </button>
          </div>
        </div>

        <!-- Fehlermeldung -->
        <div *ngIf="error" class="bg-red-50 border-l-4 border-red-500 p-4 rounded">
          <p class="text-sm text-red-800">{{ error }}</p>
        </div>

        <!-- Absenden Button -->
        <div class="flex space-x-4">
          <button
            type="submit"
            [disabled]="loading || !canSend"
            class="flex-1 btn btn-success text-lg py-3"
          >
            <span class="text-2xl mr-2">ğŸ™Œ</span>
            {{ loading ? 'Sende...' : 'High-Five senden (' + mentionedUsers.length + ')' }}
          </button>
          <button
            type="button"
            (click)="goBack()"
            class="btn btn-secondary py-3"
          >
            Abbrechen
          </button>
        </div>
      </form>
    </div>

    <!-- Tipps -->
    <div class="mt-6 card bg-blue-50">
      <h3 class="font-semibold text-blue-900 mb-2">ğŸ’¡ Tipps fÃ¼r tolle High-Fives</h3>
      <ul class="space-y-1 text-sm text-blue-800">
        <li>â€¢ Verwende @Name um eine oder mehrere Personen zu erwÃ¤hnen</li>
        <li>â€¢ Sei spezifisch, was du anerkennst</li>
        <li>â€¢ Sei authentisch und aufrichtig</li>
        <li>â€¢ Fokussiere auf die Wirkung ihrer Arbeit</li>
        <li>â€¢ Denk dran: Mindestens ein High-Five pro Woche!</li>
      </ul>
    </div>
  </main>
</div>
